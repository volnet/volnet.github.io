区块链技术驱动金融
========================================

数字货币与智能合约技术

[美]阿尔文德·纳拉亚南（Arvind Narayanan） 约什·贝努（Joseph Bonneau） 爱德华·费尔顿（Edward Felten） 安德鲁·米勒（Andrew Miller） 史蒂文·戈德费德（Steven Goldfeder） 著

林华 王勇 初帅 蔡凯龙 许余洁 李耀光 高晓婧 洪浩 译

解密区块链，用技术重构金融世界

![](contents/wx-cover.png)

中文版序 资产证券化可能成为区块链最好的一个应用 谢平
----------------------------------------

区块链概念随着比特币而逐渐被人所知，区块链技术给我们创造了一个用“共信力”来解决公信力问题的途径。

互联网科技与传统金融机构有待进一步的融合，区块链为银行、保险等机构提供当前许多问题的解决方案，帮助他们寻找新的机会服务客户。

资产证券化与区块链有一个很好的结合点，资产变成货币，就是一种证券化，然后把它们记录到分布式账本，通过场景建立起映射关系，实现所谓的货币化，其中最有可能的场景就是交易所。

区块链技术仍不成熟，它极有可能被滥用，因此要加强金融监管和行业规则的技术创新，才能保证不会出现新的非法集资或者金融不稳定的来源。

区块链不仅仅是货币创造，而且是价值传输或公共账户，是推动诚信社会建立的有效手段。

中文版序 区块链到底是什么？ 肖风
----------------------------------------

区块链首先是一种社会思潮。凯文·凯利《失控》一书里观察及论述到的基于生物逻辑的自然、社会、技术的进化规律：分布式、去中心；从边缘到中心再到边缘，从失控到控制再到失控。

区块链其次是一串技术组合。分布式账本、新型数据库、智能合约、TCP/IP模型（互联网模型）里的点对点价值传输协议（可以利用互联网传递价值物）。

区块链还是FinTech（金融科技）的核心。互联网金融侧重于场景革命，而科技金融侧重于技术革命。金融科技侧重的是云计算、大数据、机器学习、人工智能等创新技术。

译者前言
----------------------------------------

这本书起源于业内所熟知的比特币和加密货币技术的普林斯顿网络公开课。本书讨论的是比特币的一系列重要问题。比特币是如何运作的？它因何而与众不同？你的比特币安全吗？比特币用户如何匿名？我们可以在比特币这一平台上创建什么应用程序？加密数字货币可以被监管吗？创建一种新的数字货币将会带来什么样的变化？未来将会如何发展？本书中，作者承认比特币及区块链技术为各种领域带来了颠覆性的创新，但他们并不认可那种以去中心化为目的的观点。

原版引言
----------------------------------------

比特币和加密数字货币是当前的热门话题。乐观主义者认为比特币将从根本上改变人们的支付方式、全球经济甚至政治格局；悲观者则认为它生来就不完美，其失败是注定且彻底的。

究其根本，这些分歧之所以存在，是因为人们没弄清楚到底什么是比特币以及它是如何运作的。本书的目的就是带你弄懂它。

原版前言 通往比特币的漫长道路 杰里米·克拉克（Jeremy Clarek）
----------------------------------------

本章主要讲述了比特币之前与之类似的一些技术探索与技术思路，其中有一些在比特币白皮书（[英文](https://bitcoin.org/bitcoin.pdf)|[中文](https://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf)）中也有引用。

1. 传统金融体系，为了让物物交换能够在同一时间地点高效进行，演化出了现金和信用体系。比特币属于现金类的。
2. 网络信用卡的弊端，最初的网络交易需要将信用卡信息交给收款方，后来演化成交给中介机构如PayPal，还有一些不常见的中介形态如[SET](https://en.wikipedia.org/wiki/Secure_Electronic_Transaction)利用浏览器将交易和信用卡信息记录在浏览器里，收款方不能解密，只有中介可以，收款方将从付款方收到的加密信息和自身的交易信息一并提交给中介，中介解密后才批准支付。
3. 从信用到（加密）现金，最初[大卫·乔姆（David Chaum）](https://en.wikipedia.org/wiki/David_Chaum)提出通过数字签名发放电子纸条（上面写着支付金额），但因此会遇到**双重支付（double spending）**问题（一张纸条复制给两个人），一种优化的方案是在其中增加加密的个人信息，只有你本人知道，接收方会随机挑选一部分密码要求你解密，而且每次挑选都是不一样的，这样就可以防止双重支付的问题。另一个是**货币分割**的问题，[梅克尔树](https://en.wikipedia.org/wiki/Merkle_tree)可以用来解决这个问题，比特币也用到了。后来乔姆又成立了[数字现金（DigiCash）公司](https://en.wikipedia.org/wiki/DigiCash)，其他人还发明了魔法货币（Magic Money）、Lucre系统等来解决类似的问题，数字现金公司后来还发明了硬件读卡器来作为交易双方的信息交换方式，另一家[Mondex电子钱包公司](https://en.wikipedia.org/wiki/Mondex)也推出类似系统。
    > 将现金和信用进行比较，我们发现，现金体系需要启动自循环，但优势在于，它规避了买家拒不偿还债务的风险。此外，现金体系还有另外两个优势：第一，更好地确保了用户的匿名性。信用卡与个人信息绑定，因此，银行可以追查消费者的所有消费记录。但是，如果使用现金交易，就与银行无关，卖家也无须知道消费者的个人信息。第二，现金支持线下交易，无须致电第三方获得交易批准。也许交易完成后需要把钱存入银行，但这要容易得多。
    >
    > 比特币没有这两个特点，但具备两个类似的功能。它的匿名性比不上现金。用户在使用比特币支付时，无须使用自己的真实身份，但是，如果用户不够小心谨慎，可以借助公开的交易账目和聪明的算法查出用户的交易记录并最终查出用户身份。我们将在第6章展开这个复杂又有趣的比特币匿名性问题。
    >
    > 比特币并不完全支持线下交易。但优点是，它不需要中央处理器，而是依赖点对点网络，这种网络跟互联网一样具有很强的修复能力。我们将在第3章讨论“绿色地址”和小额支付工具，它们可以帮助我们在特定条件和特定情境下进行线下支付。
4. 凭空发行货币，会导致货币价值降低，因此出现了几种解决办法。
    - 提供货币的同时用美元交换。（价值随美元波动）
    - 发行货币前将等值美元存起来（放入保险库）。（价值随美元波动）
    - 花时间解决数学问题——与黄金一样具有稀缺性。（电子货币自成体系，价值自由浮动且具备真实价值）
5. 把一切信息都记录在数据库账本中，利用区块链来保证记录的安全性。区块链技术更早就用在了文件防篡改上。在比特币推出之前，[戴伟（Wei Dai）](https://en.wikipedia.org/wiki/Wei_Dai#b-money)提出的B币（B money），与比特币不同的是，每个节点并不记录全部信息，而是有它自认为是准确的记录每个人账户余额的账本。[尼克·萨博（Nick Szabo）](https://en.wikipedia.org/wiki/Nick_Szabo)提出了一个类似的方案，名为比特黄金（Bitgold）。以上两种，都没有给出详细设定或程序源代码。二者都涉及可能无解的若干问题。
6. 关于[中本聪](https://en.wikipedia.org/wiki/Satoshi_Nakamoto)的猜测，在维基百科准备删除比特币词条时，中本聪建议这样描述比特币：“比特币是戴维在1998年在网络朋克中所提到的B币构想和尼克·萨博提出的比特黄金的具体实现”。比特币官方网址：[bitcoin.org](https://bitcoin.org/)，比特币白皮书（[英文](https://bitcoin.org/bitcoin.pdf)|[中文](https://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf)）。

第1章 密码学及加密货币概述
----------------------------------------

加密货币无疑要涉及到密码学，可以利用密码学防止对系统的干扰，并且能够避免混淆，也能用其将新货币单位创造规则编码到数学协议中。

### 1.1 密码学哈希函数

哈希函数达到安全，要求具有三个附加特性：

#### 1. 碰撞阻力（collision-resistance）
    哈希函数可以输入任意字符串，并且输出固定位数的结果。因为输入是无限的，输出是有限的，所以总能找到多个输入对应1个输出的情况。如果无法找到`x≠y,H(x)=H(y)`则称之为哈希函数存在碰撞阻力。一下特定的哈希函数可以简单找到碰撞，比如`H(x)=x mod 2^256`（3和3+2^256存在碰撞），但是有一些哈希函数找到碰撞的概率小到可以忽略。现在人们实践中依赖的加密的哈希函数仅仅是人们经过不懈努力之后暂未成功找到碰撞的函数。

    因为哈希函数的特性，可以它的输出来做信息摘要，比如对大文件生成HASH值，可以确保文件未被篡改。
#### 2. 隐秘性（hiding）
    哈希函数H具有隐秘性，如果：当其输入r选自一个高阶最小熵（high min-entroy）的概率分布（分布的分散程度，高阶最小熵代表分散程度高），在给定H(rǁx)条件下来确定x是不可行的。如果r是从长度为256位的字符串中随意选出的，那么任意特定字符串被选中的概率为1/2^256，这是一个小到几乎可以忽略的取值。

    举例：
    - H(000)=38ddks，H(111)=920882，那么要从38ddks反解出000就相对容易。
    - H(000ǁ1faljsdofau)=392002，H(111ǁuosdflasdfd)=8dkowp，要再从392002反推出000就比较难，原因在于虽然000和111只有两个数，但是与之相连的值来自于一个分散度很高的集合。

    应用：承诺
    - 将一段消息msg和一个随机数nonce（解密钥匙）传入哈希，生成一个固定长度的结果称之为承诺，将它公之于众，如果要兑现承诺，就可以说出msg和解密钥匙nonce，其他人可以核实H(nonceǁmsg)和之前的给出的结果是否一致，来判断是否违背承诺。

#### 3. 谜题友好（puzzle-friendliness）
    谜题友好：如果对于任意n位输出值y，假定k选自高阶最小熵分布，如果无法找到一个可行的方法，在比2^n小很多时间内找到x，保证H(kǁx)=y成立，那么我们称哈希函数H为谜题友好。

    因为通过y是猜不出x的（因为k的存在），所以谜题友好意味着对于这个谜题没有一个解决策略，比只是随机地尝试x取值会更好。

#### 安全哈希算法

安全哈希算法（Secure Hash Algorithm 256，简称SHA-256）。它利用了这样一个压缩函数，这个压缩函数把一个768位（256+512）的输入压缩成一个256位的输出，每个区块的大小是512位。

- 假定一个文件很长（任意长度），分割成n个512位区块，不足的补齐。
- 给定一个初始向量256位，与第一个区块512位，组成一个768位的输入。
- 传递给压缩函数，生成256位的哈希值，将这个值和下一个区块512位再组成一个768位的输入。
- 循环至所有区块预算完成，得到一个256位的哈希值。

这样一个利用固定长度输入的哈希函数，通过一般方法（如上是分割），就可以将其转化为可接受任意长度输入的哈希函数，我们称这个转换过程为MD（Merkle-Damgard）变换，SHA-256是采用这种变换方法的常用哈希函数之一。

### 哈希指针及数据结构

简单来说，哈希指针是一个指向数据存储位置（地址）及其位置数据（数据本身）的哈希值的指针。

#### 区块链

区块链是由以下部分组成：

1. 创世区块（genesis block）：链表头部的哈希指针。
2. 下一个区块：指向创世区块的哈希指针 以及 该区块的数据。
3. 再下一个区块：指向上一个区块的哈希指针 以及 该区块的数据。
4. 重复以上步骤
5. 最后一个哈希指针H(end)指向最后一个含有数据的区块。

将最后一个哈希指针H(end)，储存在无法改动的地方，那么从整个区块链任何位置修改任意区块的内容，都会导致下一个区块所保存的哈希指针值发生变化，进而导致后续所有的区块的哈希指针都发生变化，直到H(end)，因为它无法篡改，所以前面一旦篡改就会被最终发现。

#### 梅克尔树

梅克尔树（Merkle trees）是一棵二叉树，将一组数据块两两分组，并分别计算各自的哈希值，并在上一级节点将二者关联后再计算哈希值，然后将这些父节点再次两两分组，如此反复，直到所有节点汇聚成最终的根结点的哈希值。

因此任意数据块被修改，都会导致由它到根结点的路径值不匹配，因此任意篡改都会被检测到。

##### 隶属证明

与区块链不同，梅克尔树的另一个特点是可以实现简洁的隶属证明。

- 某人想要证明“某个数据块隶属于梅克尔树”：提供数据块信息以及该数据块通向根节点的那些区块（整条路径）。
- 我们通过验证根节点，以及路径上的节点，可以判断它提供的数据块是否隶属于这个梅克尔树。

该算法的验证过程需要时间约为log(n)（n为整个梅克尔树的节点数量），这样就可以很快在包含大量区块的梅克尔树上证明隶属关系。

一个排序梅克尔树是把底层的数据通过某些排序得到的梅克尔树，这里的排序规则可以是字母表排序、字典排序、数字化排序，或者其他约定的排序方式

#### 非隶属证明

针对排序梅克尔树，我们可以证明一个数据区块并非来自某梅克尔树。

具体步骤是：

- 根据排序在数据块中找到比它排序靠前和靠后的分别一个区块。
- 如果之前、之后两个区块在树上是连续的，那么这说明了被验证区块与该梅克尔树之间是非隶属关系。因为被验证区块确实隶属于梅克尔树，它需要在两个条目之间，而如果两个条目是连续的话，二者之间则并没有空间。

### 1.3 数字签名

数字签名被认为是对纸上手写签名的数字模拟，它包含两个特性：

1. 只有你可以制作你自己的签名，但任何看到它的人都可以验证其有效性。有效签名即`verify(pk, message, sign(sk, message)) == true`（pk公钥，sk私钥）。
2. 我们希望签名只与某一特定文件发生联系，因此该签名不能用于表明你同意或支持另一份不同的文件，即签名不可伪造。

实践中，签名算法是随机的（良好的随机性会带来安全），message通常采用原始信息的哈希，也可以直接对整个区块链末尾的哈希指针进行签名，等价于对整条区块链实现了签名。

#### 椭圆曲线数字签名算法

比特币并没有采用标准椭圆曲线“secp256k1”算法，而是采用了ECDSA，一种早前DSA算法利用了椭圆曲线的升级版。

### 1.4 公钥即身份

因为可以通过公钥验证一个人签名的信息是否正确，因此这个公钥即可代表这个人的真实意思表达。

#### 去中心化身份管理

既然公钥可以代表一个人的身份，而公钥私钥是成对随机出现的，你可以随时为自己创建一对公私钥，这就是你的匿名化身份。

虽然可以通过公钥实现匿名性，但是随着时间的推移，你创建的身份会做出一系列的声明。人们看到这些声明便知道拥有这个身份的人做出了特定的一系列行为。他们能够开始将细节联系起来，从这一系列的行为推断出你的真实身份。这就是比特币等加密货币的基本隐秘性问题。

### 1.5 两种简单的加密货币

#### [高飞币（GoofyCoin）](https://github.com/nihalmurmu/goofy-coin)

高飞币是最简单的加密货币，它只有两个规则，一个是高飞可以随时创建新币，每个币有个唯一的uniqueid，一个是拥有此币的人可以将其转给其他人。由此币的当前拥有者，通过将此币和别人的身份（公钥）进行签名，公布此币的所有权转移。

该币有个没有解决的问题，就是双重支付（double spending）。也就是拥有者可以把一个货币签署给两个不同的人，导致两个人对同一个币有所有权，这在货币系统中是不可行的。

#### 财奴币（ScroogeCoin）

财奴币是在高飞币的基础上创建的，它新增了一个中心化的“财奴”用于记录所有的交易，只有在这个中心账本上被确认的交易才生效。中心账本是一个仅仅只能增加的账本，所有记录都会被追加，而不是修改。它有两种交易类型，一种是创建货币（CreateCoins），一种是支付货币（PayCoins），创建货币允许生成多个货币、且有不同的数量，比如2元、5元，支付货币在货币所有权转移的时候发生，这时候会将某个货币销毁，并由财奴新增交易新币，比如你有5元，你需要支付3元，那么你的5元的那个货币就销毁了（记入账本），然后再发行1个3元，1个2元的，其中3元的签署给货币的接收方（记入账本），2元签署给你自己（记入账本），由此完成一次支付。

财奴币的问题在于它是“中心化的”，而这样的结构将导致无法真正被大家所接受。

第2章 比特币如何做到去中心化
----------------------------------------

第3章 比特币的运行机制
----------------------------------------

第4章 如何储存和使用比特币
----------------------------------------

第5章 比特币挖矿
----------------------------------------

第6章 比特币和匿名性
----------------------------------------

第7章 社区、政治和监管
----------------------------------------

第8章 其他挖矿算法
----------------------------------------

第9章 比特币“平台”
----------------------------------------

第10章 另类币和加密货币生态系统
----------------------------------------

第11章 去中心化机构：比特币的未来？
----------------------------------------

结束语
----------------------------------------
