MongoDB应用设计模式
==================

前言
------------------

本书可提供用户需要的MongoDB特性和姐姐商业应用上的问题。本书重点关注MongoDB具体实现中遇到的实践性问题，特别适合那些希望利用MongoDB来应对特定扩展性问题的开发者阅读。

尽管本书对大部分MongoDB特性有一个基本描述，但本书并不是一本关于MongoDB的入门书籍。

第一部分 设计模式
------------------

第1章 嵌入还是引用
------------------

关系型数据库中，为了满足第一范式，可能带来冗余，为了消除冗余，可能要增加表。它给插入和更新记录都带来了一定的复杂性。

更大的问题在于，从多张表中查询数据，需要进行join操作，而该操作会导致磁盘的随机寻道。如果只查询一行记录，寻址时间占到了整个数据读取时间的99%以上。

即便现代的数据库都采用了一些内存对象来缓存优化，但是join操作还是非常昂贵的。

为了减少join带来的性能影响，一些系统又被设计成满足第一范式的，从而带来了大量的冗余。

MongoDB有一个概念就是数据不必总是列成表格，基本上否决了传统数据库从第一范式开始进行标准化的操作。

MongoDB即允许采用嵌入的方式存储文档，也可以按照标准化的方式（引用）存储文档：

嵌入的方式：

```
{
    "_id":3,
    "name":"Jenny",
    "zip_code":"01209",
    "numbers":["555-333-3456", "555-334-3411"]
}
```
标准化的方式（引用）：
```
// 联系人文档：
{
    "_id":3,
    "name":"Jenny",
    "zip_code":"01209"
}
// 电话号码文档：
{"contact_id":3, "number":"555-333-3456"}
{"contact_id":3, "number":"555-334-3411"}
```

嵌入模式：

- 可以支持一对多关系
- 希望保持数据的原子性和独立性
- 提供最好的性能和数据完整性保证

引用模式：

- 将用户数据模型标准化到多个容器，将会提升执行查询的灵活性，从而获得更好的性能。
- 有十分高或者无法预测的引数的一对多关系时。举例来说，一个拥有大量读者参与度的流行博客中，某个博客文章可能有成百上千的评论。如果采用嵌入方式就会带来明显的损失：
    - 文档越大，使用的内存就越大
    - 增长的文档最终必须拷贝到更大的空间中。
    - MongoDB文档最大不能超过16MB。

如何选择：

- 如果应用程序的查询模式是常见的，并且倾向于采用一种方式访问数据，那么嵌入式的途径就可以很好的工作。如果应用程序可能采用多种方式查询数据，或者您无法预计数据查询的模式，那么采用更“标准化”（引用）的方式可能更好。

多对多关系：

- 采用引用的方式，会导致查询过程较复杂
- 采用嵌入的方式，会导致更新的时候会导致需要更新所有潜入了该对象的文档的信息。
- 建议：采用折中的方式，嵌入_id的列表，而不是嵌入完整的文档。

总的来说，使用哪种方式取决于应用程序的访问方式，在MongoDB中很少有类似关系型数据库中所必须遵循的规则。灵活地使用MongoDB所提供的模式设计将有助于更好地使用这个强大的非关系型数据库。

第2章 多态模式
------------------

第3章 模仿事务行为
------------------

第二部分 应用实例
------------------

第4章 运营智能
------------------

第5章 电子商务
------------------

第6章 内容管理系统
------------------

第7章 在线广告网络
------------------

第8章 社交网络
------------------

第9章 在线游戏
------------------

后记
------------------