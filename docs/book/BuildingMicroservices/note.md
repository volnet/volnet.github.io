微服务设计（Building Microservices）
========================================

[英]Sam Newman著

崔力强 张骏 译

第1章 微服务
---------------------

微服务的诞生离不开下面这些技术实践的发展，而这些技术在10年前几乎是很难想象的：

| 实践类型      |    作用/现象                                            |
|:------------:|:-----------------------------------------------------:|
| 领域驱动设计   | 帮助理解用代码呈现真实世界的重要性、告诉我们如何更好建模        |
| 持续交付      | 如何更有效及高效地发布软件产品                              |
| 按需虚拟化     | 能够按需创建机器并调整其大小                               |
| 基础设施自动化  | 很容易从一台机器扩展到多台                                |
| 小型自治团队   | 对某个服务的全生命周期负责                                |
| 大型集群系统   | Netflix分享了构建大型反脆弱系统的经验                      |

### 1.1 什么是微服务

微服务就是一些协同工作的**小**而**自治**的服务。

#### 1.1.1 很小，专注于做好一件事

微服务的理念：单块系统->抽象层或模块->内聚性->确定服务边界。

在考虑微服务的时候，内聚性这一概念很重要。[单一职责原则](http://programmer.97things.oreilly.com/wiki/index.php/The_Single_Responsibility_Principle)认为：把因相同原因而变化的东西聚合到一起，而把不同原因而变化的东西分离出来。该论述很好地强调了内聚性这一概念。

微服务将这个理念应用在独立的服务上。根据业务的边界来确定服务的边界，这样就很容易确定某个功能代码应该放在哪里。

代码库多小才算小？作者的答案是：

1. **足够小即可，不要过小**。用户通常能够意识到“过大”，那么当他们不觉得“过大”的时候，就说明足够小了。

2. **和团队结构匹配**。

服务越小越好吗？不是。服务越小，独立性带来的好处就越多，但是管理大量服务也会越复杂。

#### 1.1.2 自治性

1. **相互隔离**：服务的部署应该尽量隔离，尽量避免在一台机器上。服务之间均通过网络调用进行通信，从而加强了服务之间的隔离性，避免紧耦合。

2. **低耦合**：你是否能够修改一个服务并对其进行部署，而不影响其他任何服务？

### 1.2 主要好处

#### 1.2.1 技术异构性

最合适的技术，最大生产力：在不同的服务中使用最适合该服务的技术，也将从这些最适合的技术中受益。

#### 1.2.2 弹性

因为分散，所以安全：在单块系统中，如果服务不可用，则所有的功能都会不可用。在微服务架构中，服务边界形成了舱壁，本身就能够很好地处理服务不可用和功能降级的问题。

#### 1.2.3 扩展

独立，所以可以分别扩展：可以对单个微服务进行扩展，而不是对整个单块应用进行扩展，因此使系统扩展变得更容易。

#### 1.2.4 简化部署

独立，所以可以单独部署：两次发布之间的差异越大，出错的可能性就越大。单块系统任何变更都需要全部发版。但微服务可以单独发版，如果失败也可以较容易回滚。

#### 1.2.5 与组织机构相匹配

小型代码库+小团队更高效：大团队和大代码库经常容易引起问题。微服务架构可以很好地将架构与组织结构相匹配，避免出现过大的代码库。从而获得理想的团队大小及生产力。

#### 1.2.6 可组合性

支持不同应用种类：在微服务的架构中，系统会开放很多接缝供外部使用。现在的应用程序种类繁多，包括Web、原生应用、移动端Web、平板应用、可穿戴设备等，针对每一种都应该考虑如何对已有功能进行组合来实现这些应用。

#### 1.2.7 对可替代性的优化

因为小，所以可以删了重写：如果是单块系统庞大而无人敢碰，同时对业务至关重要，维护起来：工作量很大、风险很高。微服务架构，服务小，重写或移除一个或者多个服务的阻碍也很小。

### 1.3 面向服务的架构

实施SOA会遇到这些问题：

1. 通信协议（如SOAP)如何选择

2. 第三方中间件如何选择

3. 服务粒度如何确定

现有的SOA知识并不能帮助你把应用程序划小。它没有提到多大算大，也没有讨论如何在现实世界中有效地防止服务之间的过度耦合。由于这些点没有说清楚，所以你在实施SOA时会遇到很多问题。

在现实世界中，由于我们对项目的系统和架构有着更好的理解，所以能够更好地实施SOA，而这事实上就是微服务架构。可以认为微服务架构是SOA的一种特定方法。

### 1.4 其他分解技术

#### 1.4.1 共享库

缺点：

1. 无法选择异构技术

2. 会失去独立地对系统某一部分进行扩展的能力。

3. 每次更新都需要重新部署整个进程。

4. 缺乏一个明显的接缝来建立架构的安全性保护措施，从而无法确保系统的弹性。

#### 1.4.2 模块

缺点：

1. 有些语言不支持模块，则模块作者需要做更多工作来对模块进行适当的隔离，比如Java的OSGI。

2. 一个进程内，模块之间的耦合性难以控制。

3. 模块受限于语言，技术异构性受限。

### 1.5 没有银弹

使用微服务架构，必须要面对所有分布式系统需要面对的复杂性。

为了得到微服务的好处，需要：

1. 在部署、测试和监控等方面做很多的工作。

2. 考虑如何扩展系统。

3. 保证它们的弹性。

4. 处理类似分布式事务或者与CAP相关的问题。

### 1.6 小结

本章介绍了微服务、微服务与其它组合技术有何不同，以及它能够带来的主要好处是什么。

第2章 演化式架构师
---------------------

第3章 如何建模服务
---------------------

第4章 集成
---------------------

第5章 分解单块系统
---------------------

第6章 部署
---------------------

第7章 测试
---------------------

第8章 监控
---------------------

第9章 安全
---------------------

第10章 康威定律和系统设计
---------------------

第11章 规模化微服务
---------------------

第12章 总结
---------------------